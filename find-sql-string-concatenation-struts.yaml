rules:
  - id: find-sql-string-concatenation-struts
    message: In Class $CLASS method $METHOD, $X is used to construct a SQL query via string concatenation and get parameter $VALUE via function $XF.
    languages:
      - java
    severity: ERROR
    
    patterns:
    - pattern-inside: |
        class $CLASS {
          $METHOD(..., $TYPE $X, ...) {
            ...
          }
        }
    - patterns:
      - pattern-either:
        - pattern: $QUERY += ... + $X.$XF($VALUE) + ...
        - pattern: $QUERY = $QUERY + ... + $X.$XF($VALUE) + ...
    metadata:
      category: security
      technology:
        - struts
      confidence: MEDIUM
      cwe:
        - "CWE-89: Improper Neutralization of Special Elements used in an SQL
          Command ('SQL Injection')"
      owasp:
        - A01:2017 - Injection
        - A03:2021 - Injection
      references:
        - https://owasp.org/Top10/A03_2021-Injection
      cwe2022-top25: true
      cwe2021-top25: true
      subcategory:
        - vuln
      likelihood: LOW
      impact: HIGH
      license: Commons Clause License Condition v1.0[LGPL-2.1-only]
      vulnerability_class:
        - SQL Injection
